import{_ as de,u as fe,a as ce,i as $,r as j,f as me,w as W,o as ge,G as ue,H as ye,I as pe,J as _e,g as m,h as c,j as n,k as r,D as X,n as he,p as h,T as ee,F as v,c as U,K as B,L as Ie,q as y,s as we,t as d,v as R,m as w,l as L,z as S,A as be,B as ve}from"./index.6a045b6f.js";import{_ as te}from"./not-available-preview.bcc87719.js";const Le={components:{},setup(){const k=fe(),s=ce(),V=$("appSettings"),t=$("modelList"),l=j({loading:!1,isEmpty:!0,fab:"",stage:"",model:"",modelState:"",defectType:"",imageDefectList:[],imageDateList:[],imageOpIdList:[],imageModelNoList:[],fullDefectList:[],retypeList:[],headerClass:"none",showRetypeOnly:!1,showHistory:!1,showZoomSlider:!1,zoomSilderLevel:25,showModelNo:!1,showHelper:!1,helperImageData:{},helperImageList:[],historyImageDefectList:[],historyImageDateList:[]}),z=()=>{window.pageYOffset>0?l.headerClass="0 15px 20px -5px rgba(65, 65, 65, 0.2)":l.headerClass="none"},u=j({defectType:!0,defect:"All",date:"All",op_id:"All",model_no:"All"}),p=j({defect:"All",date:"All"}),o=j({imageDefectList:[],imageList:[],filteredImageList:[],historyImageList:[],retypeImageList:[],retypedImageData:[],filteredHistoryImageList:[]}),H=a=>{let f=[];for(const i in a)a[i].forEach(g=>{const b={defect:i,...g};f.push(b)});return f},P=()=>{let a=o.filteredImageList;const f=Object.entries(a.reduce((i,g)=>(i[g.defect]?i[g.defect]++:i[g.defect]=1,i),{})).map(([i,g])=>({defect:i,count:g}));return f.length==0?l.isEmpty=!0:l.isEmpty=!1,f},O=a=>[...new Set(Object.values(a).flat().map(g=>g.date))].sort((g,b)=>new Date(b)-new Date(g)),Z=a=>Object.keys(a).sort(),C=a=>[...new Set(Object.values(a).flat().map(i=>i.op_id))],_=a=>[...new Set(Object.values(a).flat().map(i=>i.model_no))],I=()=>{l.loading=!0,l.isEmpty=!1;let a=l.model;l.modelState!=2&&(u.defectType?a=l.model+"_DEFECT":a=l.model+"_REPAIR"),l.fab!==void 0&&U({method:"GET",params:{fab:l.fab,stage:l.stage,model_name:a},url:`${s.blobs_accurate_retype}`}).then(function(f){let i=f.data.data.files;o.imageList=H(i),l.imageDateList=O(i),l.imageOpIdList=C(i),l.imageModelNoList=_(i),u.date=l.imageDateList[0]}).catch(function(f){l.isEmpty=!0,console.log(f)}).finally(function(){l.loading=!1,F()})},q=()=>{for(let a=0;a<o.filteredImageList.length;a++)o.filteredImageList[a].retypedDefect=void 0},A=()=>{u.defect!="All"&&(o.filteredImageList=o.filteredImageList.filter(a=>a.defect==u.defect))},G=()=>{u.date!="All"&&(o.filteredImageList=o.filteredImageList.filter(a=>a.date==u.date))},J=()=>{u.op_id!="All"&&(o.filteredImageList=o.filteredImageList.filter(a=>a.op_id==u.op_id))},N=()=>{u.model_no!="All"&&(o.filteredImageList=o.filteredImageList.filter(a=>a.model_no==u.model_no))},M=()=>{p.date!="All"&&(o.filteredHistoryImageList=o.filteredHistoryImageList.filter(a=>a.date==p.date))},K=()=>{p.defect!="All"&&(o.filteredHistoryImageList=o.filteredHistoryImageList.filter(a=>a.defect==p.defect))},F=()=>{l.showRetypeOnly=!1,o.retypedImageData=[],o.filteredImageList=o.imageList,q(),G(),J(),N(),l.imageDefectList=P(),setTimeout(()=>{A()},500)},Y=()=>{o.filteredHistoryImageList=o.historyImageList,K(),M()},e=()=>{l.fab!==void 0&&U({method:"GET",params:{fab:l.fab,stage:l.stage},url:`${s.blobs_get_helper_image}`}).then(function(a){l.helperImageData=a.data.data.files}).catch(function(a){console.log(a)})},T=()=>{l.helperImageData.hasOwnProperty(l.defectType)?l.helperImageList=l.helperImageData[l.defectType]:l.helperImageList=[]},Q=()=>{l.loading=!0;let a=l.model;l.modelState!=2&&(u.defectType?a=l.model+"_DEFECT":a=l.model+"_REPAIR"),U({method:"GET",params:{fab:l.fab,stage:l.stage,model_name:a},url:`${s.blobs_accurate_retype_history}`}).then(function(f){let i=f.data.data.files;o.historyImageList=H(i),o.filteredHistoryImageList=H(i),l.historyImageDateList=O(i),l.historyImageDefectList=Z(i)}).catch(function(f){console.log(f)}).finally(function(){l.loading=!1,l.showHistory=!0})},le=()=>{if(l.defectType==""){B({showClose:!0,message:"\u8ACB\u9078\u64C7 Defect Code.",type:"error"});return}for(let a=0;a<o.retypeImageList.length;a++){const f=o.retypeImageList[a],i=o.filteredImageList[f].name;for(const b in o.retypedImageData){const x=o.retypedImageData[b];if(x.includes(i)){const E=x.indexOf(i);E!==-1&&x.splice(E,1)}}const g=o.filteredImageList.findIndex(b=>b.name===i);g!==-1&&(o.filteredImageList[g].retypedDefect=l.defectType),o.retypedImageData.hasOwnProperty(l.defectType)?o.retypedImageData[l.defectType].includes(i)||o.retypedImageData[l.defectType].push(i):o.retypedImageData[l.defectType]=[i]}o.retypeImageList=[]},ae=()=>{Object.keys(o.retypeImageList).length===0?o.retypeImageList=o.filteredImageList.map((a,f)=>f):o.retypeImageList=[]},oe=()=>{for(let a=0;a<o.retypeImageList.length;a++){const f=o.retypeImageList[a],i=o.filteredImageList[f].name;for(const b in o.retypedImageData){const x=o.retypedImageData[b];if(x.includes(i)){const E=x.indexOf(i);E!==-1&&x.splice(E,1)}}const g=o.filteredImageList.findIndex(b=>b.name===i);g!==-1&&(o.filteredImageList[g].retypedDefect=void 0)}o.retypeImageList=[]},se=()=>{const a=Object.entries(o.retypedImageData).flatMap(([i,g])=>g.map(b=>({defect:i,file_name:b})));l.loading=!0;let f=l.model;l.modelState!=2&&(u.defectType?f=l.model+"_DEFECT":f=l.model+"_REPAIR"),U({method:"POST",params:{fab:l.fab,stage:l.stage,model_name:f,model_type:l.modelState},url:`${s.blobs_accurate_retype}`,data:a}).then(function(i){o.retypedImageData=[],B({showClose:!0,message:"\u8986\u5224\u5B8C\u6210",type:"success"}),I()}).catch(function(i){B({showClose:!0,message:"\u8986\u5224\u5931\u6557",type:"error"}),console.log(i)}).finally(function(){l.loading=!1,l.showRetypeOnly=!1})},ne=()=>{Ie.confirm("\u78BA\u5B9A\u8981\u5132\u5B58\u55CE?","Confirm Retype",{confirmButtonText:"\u9001\u51FA",cancelButtonText:"\u9810\u89BD\u7D50\u679C",closeOnClickModal:!1,closeOnPressEscape:!1,type:"info"}).then(()=>{se()}).catch(()=>{Object.keys(o.retypedImageData).length!=0?l.showRetypeOnly=!0:B({showClose:!0,message:"\u5C1A\u672A\u8986\u5224\u5716\u7247",type:"error"})})},ie=me(()=>{let a=l.zoomSilderLevel;const f=100-0,i=1e3-60;return Math.floor((a-0)*i/f+60)}),re=a=>Math.floor((a-0)*940/100+60)+"px";return W(u,a=>{u.defectType?l.defectType=l.fullDefectList[0]:l.defectType="NonRepair"}),W(t,a=>{for(let f of a)f.name==l.model&&(l.fullDefectList=f.defects,l.modelState=f.online);I(),e()}),W(V,a=>{l.fab=V.value.fab,l.stage=V.value.stage,l.fab=="L5D"&&(l.zoomSilderLevel=75),l.fab=="L4A"&&(l.zoomSilderLevel=65),I(),e()}),ge(()=>{var a,f;l.model=k.query.model,l.fab=V.value.fab,l.stage=V.value.stage,l.fullDefectList=((a=t.value.find(i=>i.name===l.model))==null?void 0:a.defects)||[],l.modelState=((f=t.value.find(i=>i.name===l.model))==null?void 0:f.online)||"",l.fab=="L5D"&&(l.zoomSilderLevel=75),l.fab=="L4A"&&(l.zoomSilderLevel=65),I(),e(),window.addEventListener("scroll",z)}),ue(()=>{window.removeEventListener("scroll",z)}),{modelList:t,state:l,filter:u,historyFilter:p,retypeData:o,checkScrollHeight:z,filterImage:F,retypeDefectChange:T,getRetypeHistory:Q,retypeImage:le,selectAllRetypeImage:ae,resetRetypeImage:oe,sliderValConvert:re,saveButtonConfirm:ne,enlargeValue:ie,List:ye,InfoFilled:pe,Hide:_e,getDefectImages:I,filterHistoryImage:Y}}},D=k=>(be("data-v-be665557"),k=k(),ve(),k),De=D(()=>c("i",{class:"bx bx-child"},null,-1)),xe={class:"fs-3 fw-bold text-dark"},ke={key:0},Ve={key:1},Ce={class:"d-flex align-items-center justify-content-end gap-4 enlarge-setting"},Ae={class:"d-flex flex-grow-1 w-50 align-items-center gap-3"},Te={class:"d-flex flex-column align-items-center gap-2 mt-2"},Re={key:0},Se=["src","alt","width"],He={key:0,class:"mt-6 w-100 d-flex justify-content-center"},Oe=D(()=>c("h4",{class:"fw-bold fs-2"},"Retype History",-1)),Ee={class:"d-flex w-100 flex-column align gap-3 overflow-auto"},ze={class:"d-flex w-100 justify-content-between px-3 bg-primary text-white py-3"},Ne={class:"d-flex drawer-header"},Me={key:0},Fe=D(()=>c("strong",{class:"text-center ms-5"},"Retyped As",-1)),je=D(()=>c("strong",{class:"flex-grow-1 text-center"},"Image",-1)),Ue={class:"d-flex drawer-header gap-3"},Be={key:0},Pe={class:"text-center ms-5"},Ze={class:"d-flex justify-content-center flex-grow-1"},qe=D(()=>c("img",{src:te,alt:"Image Not Available"},null,-1)),Ge={class:"text-center rounded-2"},Je=D(()=>c("strong",{class:"text-decoration-underline fs-4"},"Defect Assist ",-1)),Ke=D(()=>c("br",null,null,-1)),Ye=D(()=>c("img",{src:te,alt:"Image Not Available"},null,-1)),Qe={key:0,class:"text-center"},We=D(()=>c("strong",null,[c("i",null,"\u66AB\u7121\u5716\u7247")],-1)),Xe=[We];function $e(k,s,V,t,l,z){const u=y("el-switch"),p=y("el-col"),o=y("el-button"),H=y("el-tooltip"),P=y("ZoomIn"),O=y("el-icon"),Z=y("el-slider"),C=y("el-row"),_=y("el-option"),I=y("el-select"),q=y("DArrowRight"),A=y("vue-feather"),G=y("el-checkbox-button"),J=y("el-checkbox-group"),N=y("el-backtop"),M=y("el-image"),K=y("el-drawer"),F=y("el-card"),Y=we("loading");return d(),m(v,null,[c("div",{class:"secure bg-light border-bottom border-dark",style:X({boxShadow:t.state.headerClass})},[n(C,{sm:24,class:"mb-2 justify-content-left",gutter:12},{default:r(()=>[n(p,{sm:18},{default:r(()=>[c("div",null,[De,c("label",xe,[t.state.modelState!="2"?(d(),m("strong",ke,[R("\u7CBE\u6E96\u8986\u5224\u3000"),n(u,{modelValue:t.filter.defectType,"onUpdate:modelValue":s[0]||(s[0]=e=>t.filter.defectType=e),"active-text":"Defect","inactive-text":"IsRepair",onChange:t.getDefectImages},null,8,["modelValue","onChange"])])):w("",!0),t.state.modelState=="2"?(d(),m("strong",Ve,"\u7167\u7247\u8986\u5224\u3000")):w("",!0)])])]),_:1}),n(p,{sm:6},{default:r(()=>[c("div",Ce,[n(o,{type:"warning",icon:t.List,onClick:s[1]||(s[1]=e=>t.getRetypeHistory()),plain:""},{default:r(()=>[R("History")]),_:1},8,["icon"]),n(H,{content:"Toggle Helper",placement:"bottom"},{default:r(()=>[n(u,{modelValue:t.state.showHelper,"onUpdate:modelValue":s[2]||(s[2]=e=>t.state.showHelper=e),style:{"--el-switch-on-color":"#414141"},"inline-prompt":"","active-value":!0,"inactive-value":!1,"active-icon":t.InfoFilled,width:"40","inactive-icon":t.Hide},null,8,["modelValue","active-icon","inactive-icon"])]),_:1}),n(O,{size:20,color:"black",class:"enlarge-icon",onClick:s[3]||(s[3]=e=>t.state.showZoomSlider=!t.state.showZoomSlider)},{default:r(()=>[n(P)]),_:1}),n(ee,{name:"slide-fade"},{default:r(()=>[t.state.showZoomSlider?(d(),h(Z,{key:0,class:"slider",modelValue:t.state.zoomSilderLevel,"onUpdate:modelValue":s[4]||(s[4]=e=>t.state.zoomSilderLevel=e),size:"small","format-tooltip":t.sliderValConvert,"format-value-text":t.sliderValConvert},null,8,["modelValue","format-tooltip","format-value-text"])):w("",!0)]),_:1})])]),_:1})]),_:1}),n(C,{sm:24,class:"mt-3 gap-3 align-items-center mb-3"},{default:r(()=>[n(p,{sm:24},{default:r(()=>[c("div",Ae,[n(p,{sm:4},{default:r(()=>[n(I,{modelValue:t.filter.defect,"onUpdate:modelValue":s[5]||(s[5]=e=>t.filter.defect=e),style:{width:"100%"},filterable:"",onChange:s[6]||(s[6]=e=>t.filterImage())},{default:r(()=>[n(_,{label:"All Defect",value:"All"}),(d(!0),m(v,null,L(t.state.imageDefectList,e=>(d(),h(_,{key:e,label:`${e.defect}  /  ${e.count}`,value:e.defect},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(p,{sm:4},{default:r(()=>[n(I,{modelValue:t.filter.date,"onUpdate:modelValue":s[7]||(s[7]=e=>t.filter.date=e),style:{width:"100%"},filterable:"",onChange:s[8]||(s[8]=e=>t.filterImage())},{default:r(()=>[n(_,{label:"All Date",value:"All"}),(d(!0),m(v,null,L(t.state.imageDateList,e=>(d(),h(_,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(p,{sm:4},{default:r(()=>[n(I,{modelValue:t.filter.op_id,"onUpdate:modelValue":s[9]||(s[9]=e=>t.filter.op_id=e),style:{width:"100%"},filterable:"",onChange:s[10]||(s[10]=e=>t.filterImage())},{default:r(()=>[n(_,{label:"All OP_ID",value:"All"}),(d(!0),m(v,null,L(t.state.imageOpIdList,e=>(d(),h(_,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(p,{sm:4},{default:r(()=>[n(I,{modelValue:t.filter.model_no,"onUpdate:modelValue":s[11]||(s[11]=e=>t.filter.model_no=e),style:{width:"100%"},filterable:"",onChange:s[12]||(s[12]=e=>t.filterImage())},{default:r(()=>[n(_,{label:"All Model_NO",value:"All"}),(d(!0),m(v,null,L(t.state.imageModelNoList,e=>(d(),h(_,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(O,{size:24,onClick:s[13]||(s[13]=e=>t.state.showModelNo=!t.state.showModelNo)},{default:r(()=>[n(q)]),_:1}),n(p,{sm:6},{default:r(()=>[t.filter.defectType?(d(),h(I,{key:0,modelValue:t.state.defectType,"onUpdate:modelValue":s[14]||(s[14]=e=>t.state.defectType=e),style:{width:"100%"},placeholder:"Defect List",filterable:"",clearable:"",onChange:s[15]||(s[15]=e=>t.retypeDefectChange())},{default:r(()=>[(d(!0),m(v,null,L(t.state.fullDefectList,e=>(d(),h(_,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):w("",!0),!t.filter.defectType&&t.state.fullDefectList?(d(),h(I,{key:1,modelValue:t.state.defectType,"onUpdate:modelValue":s[16]||(s[16]=e=>t.state.defectType=e),style:{width:"100%"},placeholder:"Defect List",filterable:"",clearable:"",onChange:s[17]||(s[17]=e=>t.retypeDefectChange())},{default:r(()=>[(d(!0),m(v,null,L(t.state.fullDefectList,e=>(d(),h(_,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):w("",!0)]),_:1}),n(p,{sm:24},{default:r(()=>[n(o,{onClick:t.selectAllRetypeImage,type:"info",plain:"",round:""},{default:r(()=>[n(A,{class:"me-2",type:"zap",size:"18"}),R("Select All")]),_:1},8,["onClick"]),n(o,{onClick:t.retypeImage,type:"info",plain:"",round:""},{default:r(()=>[n(A,{class:"me-2",type:"pen-tool",size:"18"}),R("Retype")]),_:1},8,["onClick"]),n(o,{onClick:t.resetRetypeImage,type:"info",plain:"",round:""},{default:r(()=>[n(A,{class:"me-2",type:"rotate-ccw",size:"18"}),R("Reset")]),_:1},8,["onClick"]),n(o,{onClick:t.saveButtonConfirm,type:"success",round:""},{default:r(()=>[n(A,{class:"me-2",type:"send",size:"18"}),R("Submit")]),_:1},8,["onClick"])]),_:1})])]),_:1})]),_:1})],4),he((d(),h(C,{gutter:16,class:"gallery gap-3 flex-wrap min-vh-50 align-content-start overflow-hidden"},{default:r(()=>[(d(!0),m(v,null,L(t.retypeData.filteredImageList,(e,T)=>(d(),h(J,{modelValue:t.retypeData.retypeImageList,"onUpdate:modelValue":s[18]||(s[18]=Q=>t.retypeData.retypeImageList=Q),size:"large",key:T},{default:r(()=>[t.state.showRetypeOnly==!1||e.retypedDefect!=null?(d(),h(G,{key:0,label:T,border:"",class:"h-100 d-flex flex-column align-items-start gap-2 p-0 shadow-lg"},{default:r(()=>[c("div",Te,[t.state.showModelNo?(d(),m("span",Re,S(e.model_no),1)):w("",!0),c("img",{src:e.url,alt:e.name,width:t.enlargeValue,style:{"aspect-ratio":"1"}},null,8,Se),e.retypedDefect==null?(d(),m("strong",{key:1,class:"text-truncate",style:X("max-width: "+t.enlargeValue+"px")},S(e.defect),5)):w("",!0),e.retypedDefect!=null?(d(),m("strong",{key:2,class:"text-truncate",style:X("color: red; max-width: "+t.enlargeValue+"px")},S(e.retypedDefect),5)):w("",!0)])]),_:2},1032,["label"])):w("",!0)]),_:2},1032,["modelValue"]))),128)),!t.state.loading&&t.state.isEmpty?(d(),m("h3",He,"\u5C1A\u7121\u5716\u7247\u9700\u8981\u8986\u5224\u3002")):w("",!0)]),_:1})),[[Y,t.state.loading]]),n(K,{modelValue:t.state.showHistory,"onUpdate:modelValue":s[23]||(s[23]=e=>t.state.showHistory=e),title:"Retype History",direction:"rtl","close-on-click-modal":"","close-on-press-escape":!1,size:"650",class:"drawerBacktop"},{header:r(()=>[Oe]),default:r(()=>[n(N,{target:".drawerBacktop .el-drawer__body",right:40,bottom:40,class:"bg-primary text-white"}),c("div",Ee,[n(C,{gutter:20},{default:r(()=>[n(p,{span:12},{default:r(()=>[n(I,{modelValue:t.historyFilter.defect,"onUpdate:modelValue":s[19]||(s[19]=e=>t.historyFilter.defect=e),style:{width:"100%"},filterable:"",onChange:s[20]||(s[20]=e=>t.filterHistoryImage())},{default:r(()=>[n(_,{label:"All Defect",value:"All"}),(d(!0),m(v,null,L(t.state.historyImageDefectList,e=>(d(),h(_,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(p,{span:12},{default:r(()=>[n(I,{modelValue:t.historyFilter.date,"onUpdate:modelValue":s[21]||(s[21]=e=>t.historyFilter.date=e),style:{width:"100%"},filterable:"",onChange:s[22]||(s[22]=e=>t.filterHistoryImage())},{default:r(()=>[n(_,{label:"All Date",value:"All"}),(d(!0),m(v,null,L(t.state.historyImageDateList,e=>(d(),h(_,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),c("div",ze,[c("div",Ne,[t.state.showModelNo?(d(),m("strong",Me,"Model No")):w("",!0),Fe]),je]),(d(!0),m(v,null,L(t.retypeData.filteredHistoryImageList,(e,T)=>(d(),m("div",{key:T,class:"d-flex w-100 justify-content-between px-3 align-items-center gap-3"},[c("div",Ue,[t.state.showModelNo?(d(),m("span",Be,S(e.model_no),1)):w("",!0),c("strong",Pe,S(e.defect),1)]),c("div",Ze,[n(M,{style:{heigth:"auto",width:"200px"},src:e.url,"zoom-rate":1.2,"preview-src-list":[e.url],fit:"cover"},{placeholder:r(()=>[qe]),_:2},1032,["src","preview-src-list"])])]))),128))])]),_:1},8,["modelValue"]),n(ee,{name:"slide-fade"},{default:r(()=>[t.state.showHelper&&t.state.defectType!=""?(d(),h(F,{key:0,class:"box-card helper"},{header:r(()=>[c("div",Ge,[Je,Ke,c("strong",null,S(t.state.defectType),1)])]),default:r(()=>[(d(!0),m(v,null,L(t.state.helperImageList,e=>(d(),m("div",{key:e,class:"d-flex w-100 justify-content-between px-3 align-items-center gap-3"},[n(M,{style:{"padding-top":"20px",heigth:"auto",width:"200px"},src:e,"zoom-rate":1.2,"preview-src-list":[e],fit:"cover"},{placeholder:r(()=>[Ye]),_:2},1032,["src","preview-src-list"])]))),128)),t.state.helperImageList.length==0?(d(),m("div",Qe,Xe)):w("",!0)]),_:1})):w("",!0)]),_:1}),n(N,{right:40,bottom:40,class:"bg-primary text-white"})],64)}const lt=de(Le,[["render",$e],["__scopeId","data-v-be665557"]]);export{lt as default};
