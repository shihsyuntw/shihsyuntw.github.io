import{_ as W}from"./not-available-preview.bcc87719.js";import{_ as J,i as O,u as U,a as K,r as N,e as X,w as k,o as Z,c as A,g as j,h as c,j as o,k as e,n as Q,p as v,m as H,F as C,q as p,s as tt,t as g,v as Y,l as T,z as et,A as at,B as lt}from"./index.96e8eb14.js";import{D as ot}from"./Chart.e6ad0e35.js";import{r as nt}from"./introjs.7ffc334a.js";const h=q=>(at("data-v-a13758e6"),q=q(),lt(),q),st={class:"d-flex align-items-center justify-content-between mb-2"},it=h(()=>c("i",{class:"bx bx-child"},null,-1)),ct={class:"fs-3 fw-bold text-dark"},rt=h(()=>c("strong",null,"\u8CC7\u6599\u54C1\u8CEA\u3000",-1)),dt=h(()=>c("hr",null,null,-1)),ut={class:"statistic-card"},_t={style:{display:"inline-flex","align-items":"center"}},pt={class:"statistic-card"},mt=h(()=>c("div",{style:{display:"inline-flex","align-items":"center"}}," Data Quantity ",-1)),ft={class:"statistic-card"},gt=h(()=>c("div",{style:{display:"inline-flex","align-items":"center"}}," Currect Qty ",-1)),yt={class:"statistic-card"},ht=h(()=>c("div",{style:{display:"inline-flex","align-items":"center"}},"NG Qty",-1)),vt={class:"card-header2"},xt=h(()=>c("img",{src:W,alt:"Image Not Available"},null,-1)),bt=h(()=>c("div",{class:"card-header2"},[c("h4",null,"\u5C1A\u7121\u8CC7\u6599")],-1)),qt={__name:"QuantityViewYL",setup(q){const w=O("appSettings"),L=O("modelList"),B=U(),F=K(),l=N({loadingHistory:!1,loadingCount:!1,fab:"",stage:"",model:"",modelState:"",defectType:!0}),x=X([]),m=N({total_judge:0,quantity:0,currect_qty:0,ng_qty:0,tableList:[]}),z=d=>{let n=[],y=[];return Object.entries(d).forEach(([_,i])=>{const t=i.currect_qty,r=i.total_qty,u=t/r*100;n.push(_),y.push(u)}),{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},valueFormatter:_=>_.toFixed(2)+" %"},legend:{},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:n},yAxis:[{type:"value",min:0,max:100,interval:20,axisLabel:{formatter:"{value}%"}}],series:[{data:y,type:"line"}]}},S=()=>{l.loadingHistory=!0;let d=l.model;l.modelState!=2&&(l.defectType?d=l.model+"_DEFECT":d=l.model+"_REPAIR"),w.value.fab!=""&&A({method:"GET",params:{fab:w.value.fab,stage:w.value.stage,model_name:d},url:`${F.blobs_get_quantity}`}).then(function(n){let y=n.data.data.files,a={};Object.keys(y).forEach(t=>{y[t].forEach(u=>{let s=u;if(s.man_judge=="N"?s.man_judge="NonRepair":s.man_judge=="Y"&&(s.man_judge="Repair"),a.hasOwnProperty(t)||(a[t]={currect_qty:0,total_qty:0,data:{},image:[]}),a[t].total_qty++,s.man_judge===t)a[t].currect_qty++,a[t].data[s.date]===void 0&&(a[t].data[s.date]={currect_qty:0,ng_qty:0,total_qty:0}),a[t].data[s.date].total_qty++,a[t].data[s.date].currect_qty++;else{a[t].data[s.date]===void 0&&(a[t].data[s.date]={currect_qty:0,ng_qty:0,total_qty:0}),a[t].data[s.date].total_qty++,a[t].data[s.date].ng_qty++;let b=s.name,R=b.substring(b.lastIndexOf(",")+1);a[t].image.push({name:R,url:s.url})}})});let _=0;for(const t in a)_+=a[t].total_qty;m.total_judge=_;let i=0;for(const t in a)i+=a[t].currect_qty;_!=0&&i!=0&&(m.quantity=parseInt(i/_*100)),m.currect_qty=i,m.ng_qty=_-i,m.tableList=a}).catch(function(n){console.log(n)}).finally(function(){l.loadingHistory=!1})};k(L,d=>{for(let n of d)n.name==l.model&&(l.modelState=n.online,S())}),k(w,d=>{S()}),Z(()=>{var d;l.model=B.query.model,l.modelState=((d=L.value.find(n=>n.name===l.model))==null?void 0:d.online)||"",S(),G()});const P=()=>{nt().start()},G=async()=>{l.loadingCount=!0;let d=l.model;l.modelState!==2&&(l.defectType?d=l.model+"_DEFECT":d=l.model+"_REPAIR"),A({method:"GET",params:{model_name:d},url:`${F.picture_retype_count}`}).then(function(n){const y=n.data.data;let a=new Date,_=[];for(let t=7;t>0;t--){let r=new Date(a.getFullYear(),a.getMonth(),a.getDate()-t);_.push(r.getFullYear()+"-"+(r.getMonth()+1).toString().padStart(2,"0")+"-"+r.getDate().toString().padStart(2,"0"))}let i={};y.forEach(t=>{i[t.defect]||(i[t.defect]={}),_.forEach(r=>{i[t.defect][r]||(i[t.defect][r]=0)})}),y.forEach(t=>{_.includes(t.date)&&(i[t.defect][t.date]+=t.file_count)}),x.value=Object.keys(i).map(t=>{let r={defect:t};return Object.keys(i[t]).forEach(u=>{r[u]=i[t][u]}),r})}).catch(function(n){l.isEmpty=!0,console.error(n)}).finally(function(){l.loadingCount=!1})};return(d,n)=>{const y=p("QuestionFilled"),a=p("el-icon"),_=p("el-switch"),i=p("Warning"),t=p("el-tooltip"),r=p("el-statistic"),u=p("el-col"),s=p("el-row"),b=p("el-table-column"),R=p("el-table"),M=p("el-image"),V=p("el-card"),$=p("el-backtop"),I=tt("loading");return g(),j(C,null,[c("div",st,[c("div",null,[it,c("label",ct,[rt,o(a,{class:"ms-n2",size:14,onClick:n[0]||(n[0]=f=>P())},{default:e(()=>[o(y)]),_:1})]),o(_,{style:{"margin-left":"20px"},modelValue:l.defectType,"onUpdate:modelValue":n[1]||(n[1]=f=>l.defectType=f),"active-text":"Defect","inactive-text":"IsRepair",onChange:S},null,8,["modelValue"])])]),dt,Q((g(),v(s,{gutter:16},{default:e(()=>[o(u,{sm:12,md:6,"data-intro":"\u7CBE\u6E96\u8986\u5224\u7684\u7167\u7247\u7E3D\u6578(\u5C1A\u672ARetrain)","data-step":"1"},{default:e(()=>[c("div",ut,[o(r,{value:m.total_judge},{title:e(()=>[c("div",_t,[Y(" Total Judge QTY "),o(t,{effect:"dark",content:"\u5224\u7247\u7E3D\u6578",placement:"top"},{default:e(()=>[o(a,{style:{"margin-left":"4px"},size:12},{default:e(()=>[o(i)]),_:1})]),_:1})])]),_:1},8,["value"])])]),_:1}),o(u,{sm:12,md:6,"data-intro":"\u7DDA\u4E0A\u5224\u7247\u4EBA\u54E1\u7684\u6E96\u78BA\u7387","data-step":"2"},{default:e(()=>[c("div",pt,[o(r,{value:m.quantity},{title:e(()=>[mt]),suffix:e(()=>[Y(" %")]),_:1},8,["value"])])]),_:1}),o(u,{sm:12,md:6},{default:e(()=>[c("div",ft,[o(r,{value:m.currect_qty},{title:e(()=>[gt]),_:1},8,["value"])])]),_:1}),o(u,{sm:12,md:6},{default:e(()=>[c("div",yt,[o(r,{value:m.ng_qty},{title:e(()=>[ht]),_:1},8,["value"])])]),_:1})]),_:1})),[[I,l.loadingHistory]]),x.value&&x.value.length>0?Q((g(),v(R,{key:0,data:x.value,style:{width:"100%"},class:"mt-4"},{default:e(()=>[o(b,{prop:"defect",label:"\u7455\u75B5\u985E\u5225"}),(g(!0),j(C,null,T(Object.keys(x.value[0]).filter(f=>f!=="defect"),f=>(g(),v(b,{key:f,prop:f,label:f},null,8,["prop","label"]))),128))]),_:1},8,["data"])),[[I,l.loadingCount]]):H("",!0),Q((g(),v(s,{gutter:16,class:"mt-2"},{default:e(()=>[(g(!0),j(C,null,T(m.tableList,(f,E)=>(g(),v(u,{span:24,key:E,id:E},{default:e(()=>[o(V,{class:"box-card"},{header:e(()=>[c("div",vt,[c("h4",null,et(E),1)])]),default:e(()=>[o(s,null,{default:e(()=>[o(u,{span:12},{default:e(()=>[o(ot,{option:z(f.data),idx:E,style:{width:"100%",height:"350px"}},null,8,["option","idx"])]),_:2},1024),o(u,{span:12,style:{height:"400px",overflow:"auto"},"data-intro":"\u7CBE\u6E96\u8986\u5224\u4EBA\u54E1\u8207\u7DDA\u4E0A\u5224\u7247\u4EBA\u54E1\u5224\u4E0D\u4E00\u81F4\u7684\u7167\u7247\uFF0C\u6ED1\u9F20\u79FB\u81F3\u7167\u7247\u4E0A\u65B9\u53EF\u67E5\u770BLot_ID\u3001SHEET_ID","data-step":"3"},{default:e(()=>[o(s,null,{default:e(()=>[(g(!0),j(C,null,T(f.image,D=>(g(),v(u,{key:D,span:6},{default:e(()=>[o(t,{class:"box-item",effect:"dark",content:D.name,placement:"top"},{default:e(()=>[o(M,{style:{"padding-top":"20px","padding-right":"20px"},src:D.url,"zoom-rate":1.2,"preview-src-list":[D.url],fit:"cover"},{placeholder:e(()=>[xt]),_:2},1032,["src","preview-src-list"])]),_:2},1032,["content"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["id"]))),128)),m.total_judge==0?(g(),v(u,{key:0,span:24},{default:e(()=>[o(V,{class:"box-card"},{header:e(()=>[bt]),_:1})]),_:1})):H("",!0)]),_:1})),[[I,l.loadingHistory]]),o($,{right:40,bottom:40,class:"bg-primary text-white"})],64)}}},jt=J(qt,[["__scopeId","data-v-a13758e6"]]);export{jt as default};
