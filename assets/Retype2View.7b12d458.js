import{_ as ae,u as oe,a as se,i as $,r as Q,f as ne,w as W,o as ie,G as re,H as de,I as ce,J as fe,g as m,h as f,j as i,k as d,D as X,n as me,p as _,T as ee,F as w,c as N,K as F,L as ge,q as u,s as ue,t as c,v as A,m as y,l as I,z as E,A as pe,B as ye}from"./index.6a045b6f.js";import{_ as te}from"./not-available-preview.bcc87719.js";const _e={components:{},setup(){const k=oe(),s=se(),V=$("appSettings"),t=$("modelList"),e=Q({loading:!1,isEmpty:!0,fab:"",stage:"",model:"",modelState:"",defectType:"",imageDefectList:[],imageDateList:[],imageOpIdList:[],imageModelNoList:[],fullDefectList:[],retypeList:[],headerClass:"none",showRetypeOnly:!1,showHistory:!1,showZoomSlider:!1,zoomSilderLevel:25,showModelNo:!1,showHelper:!1,helperImageData:{},helperImageList:[]}),H=()=>{window.pageYOffset>0?e.headerClass="0 15px 20px -5px rgba(65, 65, 65, 0.2)":e.headerClass="none"},g=Q({defectType:!0,defect:"All",date:"",op_id:"All",model_no:"All"}),o=Q({imageDefectList:[],imageList:[],filteredImageList:[],historyImageList:[],retypeImageList:[],retypedImageData:[]}),L=a=>{let r=[];for(const n in a)a[n].slice(0,100).forEach(p=>{const v={defect:n,...p};r.push(v)});return r},B=()=>{let a=o.filteredImageList;const r=Object.entries(a.reduce((n,p)=>(n[p.defect]?n[p.defect]++:n[p.defect]=1,n),{})).map(([n,p])=>({defect:n,count:p}));return r.length==0?e.isEmpty=!0:e.isEmpty=!1,r},P=a=>[...new Set(Object.values(a).flat().map(n=>n.op_id))],M=a=>[...new Set(Object.values(a).flat().map(n=>n.model_no))],C=()=>{let a=e.model;e.modelState!=2&&(g.defectType?a=e.model+"_DEFECT":a=e.model+"_REPAIR"),!(e.fab===void 0||e.model=="")&&N({method:"GET",params:{fab:e.fab,stage:e.stage,model_name:a},url:`${s.blobs_accurate_retype_date}`}).then(function(r){e.imageDateList=r.data.data}).catch(function(r){console.log(r)})},T=()=>{e.loading=!0,e.isEmpty=!1;let a=e.model;e.modelState!=2&&(g.defectType?a=e.model+"_DEFECT":a=e.model+"_REPAIR"),!(e.fab===void 0||g.date=="")&&N({method:"GET",params:{fab:e.fab,stage:e.stage,model_name:a,date:g.date},url:`${s.blobs_accurate_retype2}`}).then(function(r){let n=r.data.data.files;o.imageList=L(n),e.imageOpIdList=P(n),e.imageModelNoList=M(n)}).catch(function(r){e.isEmpty=!0,console.log(r)}).finally(function(){e.loading=!1,j()})},h=()=>{for(let a=0;a<o.filteredImageList.length;a++)o.filteredImageList[a].retypedDefect=void 0},x=()=>{g.defect!="All"&&(o.filteredImageList=o.filteredImageList.filter(a=>a.defect==g.defect))},q=()=>{g.op_id!="All"&&(o.filteredImageList=o.filteredImageList.filter(a=>a.op_id==g.op_id))},R=()=>{g.model_no!="All"&&(o.filteredImageList=o.filteredImageList.filter(a=>a.model_no==g.model_no))},j=()=>{e.showRetypeOnly=!1,o.retypedImageData=[],o.filteredImageList=o.imageList,h(),q(),R(),e.imageDefectList=B(),setTimeout(()=>{x()},500)},O=()=>{e.fab!==void 0&&N({method:"GET",params:{fab:e.fab,stage:e.stage},url:`${s.blobs_get_helper_image}`}).then(function(a){e.helperImageData=a.data.data.files}).catch(function(a){console.log(a)})},U=()=>{e.helperImageData.hasOwnProperty(e.defectType)?e.helperImageList=e.helperImageData[e.defectType]:e.helperImageList=[]},Z=()=>{e.loading=!0;let a=e.model;e.modelState!=2&&(g.defectType?a=e.model+"_DEFECT":a=e.model+"_REPAIR"),N({method:"GET",params:{fab:e.fab,stage:e.stage,model_name:a},url:`${s.blobs_accurate_retype_history}`}).then(function(r){let n=r.data.data.files;e.historyImageList=L(n)}).catch(function(r){console.log(r)}).finally(function(){e.loading=!1,e.showHistory=!0})},G=()=>{if(e.defectType==""){F({showClose:!0,message:"\u8ACB\u9078\u64C7 Defect Code.",type:"error"});return}for(let a=0;a<o.retypeImageList.length;a++){const r=o.retypeImageList[a],n=o.filteredImageList[r].name;for(const v in o.retypedImageData){const D=o.retypedImageData[v];if(D.includes(n)){const z=D.indexOf(n);z!==-1&&D.splice(z,1)}}const p=o.filteredImageList.findIndex(v=>v.name===n);p!==-1&&(o.filteredImageList[p].retypedDefect=e.defectType),o.retypedImageData.hasOwnProperty(e.defectType)?o.retypedImageData[e.defectType].includes(n)||o.retypedImageData[e.defectType].push(n):o.retypedImageData[e.defectType]=[n]}o.retypeImageList=[]},J=()=>{Object.keys(o.retypeImageList).length===0?o.retypeImageList=o.filteredImageList.map((a,r)=>r):o.retypeImageList=[]},K=()=>{for(let a=0;a<o.retypeImageList.length;a++){const r=o.retypeImageList[a],n=o.filteredImageList[r].name;for(const v in o.retypedImageData){const D=o.retypedImageData[v];if(D.includes(n)){const z=D.indexOf(n);z!==-1&&D.splice(z,1)}}const p=o.filteredImageList.findIndex(v=>v.name===n);p!==-1&&(o.filteredImageList[p].retypedDefect=void 0)}o.retypeImageList=[]},l=()=>{const a=Object.entries(o.retypedImageData).flatMap(([n,p])=>p.map(v=>({defect:n,file_name:v})));e.loading=!0;let r=e.model;e.modelState!=2&&(g.defectType?r=e.model+"_DEFECT":r=e.model+"_REPAIR"),N({method:"POST",params:{fab:e.fab,stage:e.stage,model_name:r,date:g.date,model_type:e.modelState},url:`${s.blobs_accurate_retype2}`,data:a}).then(function(n){o.retypedImageData=[],F({showClose:!0,message:"\u8986\u5224\u5B8C\u6210",type:"success"}),T()}).catch(function(n){F({showClose:!0,message:"\u8986\u5224\u5931\u6557",type:"error"}),console.log(n)}).finally(function(){e.loading=!1,e.showRetypeOnly=!1})},S=()=>{ge.confirm("\u78BA\u5B9A\u8981\u5132\u5B58\u55CE?","Confirm Retype",{confirmButtonText:"\u9001\u51FA",cancelButtonText:"\u9810\u89BD\u7D50\u679C",closeOnClickModal:!1,closeOnPressEscape:!1,type:"info"}).then(()=>{l()}).catch(()=>{Object.keys(o.retypedImageData).length!=0?e.showRetypeOnly=!0:F({showClose:!0,message:"\u5C1A\u672A\u8986\u5224\u5716\u7247",type:"error"})})},Y=ne(()=>{let a=e.zoomSilderLevel;const r=100-0,n=1e3-60;return Math.floor((a-0)*n/r+60)}),le=a=>Math.floor((a-0)*940/100+60)+"px";return W(g,a=>{g.defectType?e.defectType=e.fullDefectList[0]:e.defectType="NonRepair"}),W(t,a=>{for(let r of a)r.name==e.model&&(e.fullDefectList=r.defects,e.modelState=r.online);C(),O()}),W(V,a=>{e.fab=V.value.fab,e.stage=V.value.stage,e.fab=="L5D"&&(e.zoomSilderLevel=75),e.fab=="L4A"&&(e.zoomSilderLevel=65),C(),O()}),ie(()=>{var a,r;e.model=k.query.model,e.fab=V.value.fab,e.stage=V.value.stage,e.fullDefectList=((a=t.value.find(n=>n.name===e.model))==null?void 0:a.defects)||[],e.modelState=((r=t.value.find(n=>n.name===e.model))==null?void 0:r.online)||"",e.fab=="L5D"&&(e.zoomSilderLevel=75),e.fab=="L4A"&&(e.zoomSilderLevel=65),C(),O(),window.addEventListener("scroll",H)}),re(()=>{window.removeEventListener("scroll",H)}),{modelList:t,state:e,filter:g,retypeData:o,checkScrollHeight:H,filterImage:j,retypeDefectChange:U,getRetypeHistory:Z,retypeImage:G,selectAllRetypeImage:J,resetRetypeImage:K,sliderValConvert:le,saveButtonConfirm:S,enlargeValue:Y,List:de,InfoFilled:ce,Hide:fe,getDefectImages:T,getDateList:C}}},b=k=>(pe("data-v-ac262142"),k=k(),ye(),k),he=b(()=>f("i",{class:"bx bx-child"},null,-1)),ve={class:"fs-3 fw-bold text-dark"},we={key:0},Ie={key:1},be={class:"d-flex align-items-center justify-content-end gap-4 enlarge-setting"},Le={class:"d-flex flex-grow-1 w-50 align-items-center gap-3"},xe={class:"d-flex flex-column align-items-center gap-2 mt-2"},De={key:0},ke=["src","alt","width"],Ve={key:0,class:"mt-6 w-100 d-flex justify-content-center"},Ce=b(()=>f("h4",{class:"fw-bold fs-2"},"Retype History",-1)),Te={class:"d-flex w-100 flex-column align gap-3 overflow-auto"},Re={class:"d-flex w-100 justify-content-between px-3 bg-primary text-white py-3"},Se={class:"d-flex drawer-header"},Ae={key:0},Ee=b(()=>f("strong",{class:"text-center ms-5"},"Retyped As",-1)),Oe=b(()=>f("strong",{class:"flex-grow-1 text-center"},"Image",-1)),ze={class:"d-flex drawer-header gap-3"},Ne={key:0},He={class:"text-center ms-5"},Me={class:"d-flex justify-content-center flex-grow-1"},je=b(()=>f("img",{src:te,alt:"Image Not Available"},null,-1)),Ue={class:"text-center rounded-2"},Fe=b(()=>f("strong",{class:"text-decoration-underline fs-4"},"Defect Assist ",-1)),Be=b(()=>f("br",null,null,-1)),Pe=b(()=>f("img",{src:te,alt:"Image Not Available"},null,-1)),qe={key:0,class:"text-center"},Ze=b(()=>f("strong",null,[f("i",null,"\u66AB\u7121\u5716\u7247")],-1)),Ge=[Ze];function Je(k,s,V,t,e,H){const g=u("el-switch"),o=u("el-col"),L=u("el-button"),B=u("el-tooltip"),P=u("ZoomIn"),M=u("el-icon"),C=u("el-slider"),T=u("el-row"),h=u("el-option"),x=u("el-select"),q=u("DArrowRight"),R=u("vue-feather"),j=u("el-checkbox-button"),O=u("el-checkbox-group"),U=u("el-image"),Z=u("el-drawer"),G=u("el-card"),J=u("el-backtop"),K=ue("loading");return c(),m(w,null,[f("div",{class:"secure bg-light border-bottom border-dark",style:X({boxShadow:t.state.headerClass})},[i(T,{sm:24,class:"mb-2 justify-content-left",gutter:12},{default:d(()=>[i(o,{sm:18},{default:d(()=>[f("div",null,[he,f("label",ve,[t.state.modelState!="2"?(c(),m("strong",we,[A("\u7CBE\u6E96\u8986\u5224\u3000"),i(g,{modelValue:t.filter.defectType,"onUpdate:modelValue":s[0]||(s[0]=l=>t.filter.defectType=l),"active-text":"Defect","inactive-text":"IsRepair",onChange:s[1]||(s[1]=l=>t.getDateList())},null,8,["modelValue"])])):y("",!0),t.state.modelState=="2"?(c(),m("strong",Ie,"\u7167\u7247\u8986\u5224\u3000")):y("",!0)])])]),_:1}),i(o,{sm:6},{default:d(()=>[f("div",be,[i(L,{type:"warning",icon:t.List,onClick:s[2]||(s[2]=l=>t.getRetypeHistory()),plain:""},{default:d(()=>[A("History")]),_:1},8,["icon"]),i(B,{content:"Toggle Helper",placement:"bottom"},{default:d(()=>[i(g,{modelValue:t.state.showHelper,"onUpdate:modelValue":s[3]||(s[3]=l=>t.state.showHelper=l),style:{"--el-switch-on-color":"#414141"},"inline-prompt":"","active-value":!0,"inactive-value":!1,"active-icon":t.InfoFilled,width:"40","inactive-icon":t.Hide},null,8,["modelValue","active-icon","inactive-icon"])]),_:1}),i(M,{size:20,color:"black",class:"enlarge-icon",onClick:s[4]||(s[4]=l=>t.state.showZoomSlider=!t.state.showZoomSlider)},{default:d(()=>[i(P)]),_:1}),i(ee,{name:"slide-fade"},{default:d(()=>[t.state.showZoomSlider?(c(),_(C,{key:0,class:"slider",modelValue:t.state.zoomSilderLevel,"onUpdate:modelValue":s[5]||(s[5]=l=>t.state.zoomSilderLevel=l),size:"small","format-tooltip":t.sliderValConvert,"format-value-text":t.sliderValConvert},null,8,["modelValue","format-tooltip","format-value-text"])):y("",!0)]),_:1})])]),_:1})]),_:1}),i(T,{sm:24,class:"mt-3 gap-3 align-items-center mb-3"},{default:d(()=>[i(o,{sm:24},{default:d(()=>[f("div",Le,[i(o,{sm:4},{default:d(()=>[i(x,{modelValue:t.filter.date,"onUpdate:modelValue":s[6]||(s[6]=l=>t.filter.date=l),style:{width:"100%"},filterable:"",onChange:s[7]||(s[7]=l=>t.getDefectImages())},{default:d(()=>[i(h,{label:"Select Date",value:""}),(c(!0),m(w,null,I(t.state.imageDateList,l=>(c(),_(h,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(o,{sm:4},{default:d(()=>[i(x,{modelValue:t.filter.defect,"onUpdate:modelValue":s[8]||(s[8]=l=>t.filter.defect=l),style:{width:"100%"},filterable:"",onChange:s[9]||(s[9]=l=>t.filterImage())},{default:d(()=>[i(h,{label:"All Defect",value:"All"}),(c(!0),m(w,null,I(t.state.imageDefectList,l=>(c(),_(h,{key:l,label:`${l.defect}  /  ${l.count}`,value:l.defect},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(o,{sm:4},{default:d(()=>[i(x,{modelValue:t.filter.op_id,"onUpdate:modelValue":s[10]||(s[10]=l=>t.filter.op_id=l),style:{width:"100%"},filterable:"",onChange:s[11]||(s[11]=l=>t.filterImage())},{default:d(()=>[i(h,{label:"All OP_ID",value:"All"}),(c(!0),m(w,null,I(t.state.imageOpIdList,l=>(c(),_(h,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(o,{sm:4},{default:d(()=>[i(x,{modelValue:t.filter.model_no,"onUpdate:modelValue":s[12]||(s[12]=l=>t.filter.model_no=l),style:{width:"100%"},filterable:"",onChange:s[13]||(s[13]=l=>t.filterImage())},{default:d(()=>[i(h,{label:"All Model_NO",value:"All"}),(c(!0),m(w,null,I(t.state.imageModelNoList,l=>(c(),_(h,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),i(M,{size:24,class:"pe-1"},{default:d(()=>[i(q)]),_:1}),i(o,{sm:6},{default:d(()=>[t.filter.defectType?(c(),_(x,{key:0,modelValue:t.state.defectType,"onUpdate:modelValue":s[14]||(s[14]=l=>t.state.defectType=l),style:{width:"100%"},placeholder:"Defect List",filterable:"",clearable:"",onChange:s[15]||(s[15]=l=>t.retypeDefectChange())},{default:d(()=>[(c(!0),m(w,null,I(t.state.fullDefectList,l=>(c(),_(h,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):y("",!0),!t.filter.defectType&&t.state.fullDefectList?(c(),_(x,{key:1,modelValue:t.state.defectType,"onUpdate:modelValue":s[16]||(s[16]=l=>t.state.defectType=l),style:{width:"100%"},placeholder:"Defect List",filterable:"",clearable:"",onChange:s[17]||(s[17]=l=>t.retypeDefectChange())},{default:d(()=>[(c(!0),m(w,null,I(t.state.fullDefectList,l=>(c(),_(h,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):y("",!0)]),_:1}),i(o,{sm:24},{default:d(()=>[i(L,{onClick:t.selectAllRetypeImage,type:"info",plain:"",round:""},{default:d(()=>[i(R,{class:"me-2",type:"zap",size:"18"}),A("Select All")]),_:1},8,["onClick"]),i(L,{onClick:t.retypeImage,type:"info",plain:"",round:""},{default:d(()=>[i(R,{class:"me-2",type:"pen-tool",size:"18"}),A("Retype")]),_:1},8,["onClick"]),i(L,{onClick:t.resetRetypeImage,type:"info",plain:"",round:""},{default:d(()=>[i(R,{class:"me-2",type:"rotate-ccw",size:"18"}),A("Reset")]),_:1},8,["onClick"]),i(L,{onClick:t.saveButtonConfirm,type:"success",round:""},{default:d(()=>[i(R,{class:"me-2",type:"send",size:"18"}),A("Submit")]),_:1},8,["onClick"])]),_:1})])]),_:1})]),_:1})],4),me((c(),_(T,{gutter:16,class:"gallery gap-3 flex-wrap min-vh-50 align-content-start overflow-hidden"},{default:d(()=>[(c(!0),m(w,null,I(t.retypeData.filteredImageList,(l,S)=>(c(),_(O,{modelValue:t.retypeData.retypeImageList,"onUpdate:modelValue":s[18]||(s[18]=Y=>t.retypeData.retypeImageList=Y),size:"large",key:S},{default:d(()=>[t.state.showRetypeOnly==!1||l.retypedDefect!=null?(c(),_(j,{key:0,label:S,border:"",class:"h-100 d-flex flex-column align-items-start gap-2 p-0 shadow-lg"},{default:d(()=>[f("div",xe,[t.state.showModelNo?(c(),m("span",De,E(l.model_no),1)):y("",!0),f("img",{src:l.url,alt:l.name,width:t.enlargeValue,style:{"aspect-ratio":"1"}},null,8,ke),l.retypedDefect==null?(c(),m("strong",{key:1,class:"text-truncate",style:X("max-width: "+t.enlargeValue+"px")},E(l.defect),5)):y("",!0),l.retypedDefect!=null?(c(),m("strong",{key:2,class:"text-truncate",style:X("color: red; max-width: "+t.enlargeValue+"px")},E(l.retypedDefect),5)):y("",!0)])]),_:2},1032,["label"])):y("",!0)]),_:2},1032,["modelValue"]))),128)),!t.state.loading&&t.state.isEmpty?(c(),m("h3",Ve,"\u5C1A\u7121\u5716\u7247\u9700\u8981\u8986\u5224\u3002")):y("",!0)]),_:1})),[[K,t.state.loading]]),i(Z,{modelValue:t.state.showHistory,"onUpdate:modelValue":s[19]||(s[19]=l=>t.state.showHistory=l),title:"Retype History",direction:"rtl","close-on-click-modal":"","close-on-press-escape":!1,size:"650"},{header:d(()=>[Ce]),default:d(()=>[f("div",Te,[f("div",Re,[f("div",Se,[t.state.showModelNo?(c(),m("strong",Ae,"Model No")):y("",!0),Ee]),Oe]),(c(!0),m(w,null,I(t.state.historyImageList,(l,S)=>(c(),m("div",{key:S,class:"d-flex w-100 justify-content-between px-3 align-items-center gap-3"},[f("div",ze,[t.state.showModelNo?(c(),m("span",Ne,E(l.model_no),1)):y("",!0),f("strong",He,E(l.defect),1)]),f("div",Me,[i(U,{style:{heigth:"auto",width:"200px"},src:l.url,"zoom-rate":1.2,"preview-src-list":[l.url],fit:"cover"},{placeholder:d(()=>[je]),_:2},1032,["src","preview-src-list"])])]))),128))])]),_:1},8,["modelValue"]),i(ee,{name:"slide-fade"},{default:d(()=>[t.state.showHelper&&t.state.defectType!=""?(c(),_(G,{key:0,class:"box-card helper"},{header:d(()=>[f("div",Ue,[Fe,Be,f("strong",null,E(t.state.defectType),1)])]),default:d(()=>[(c(!0),m(w,null,I(t.state.helperImageList,l=>(c(),m("div",{key:l,class:"d-flex w-100 justify-content-between px-3 align-items-center gap-3"},[i(U,{style:{"padding-top":"20px",heigth:"auto",width:"200px"},src:l,"zoom-rate":1.2,"preview-src-list":[l],fit:"cover"},{placeholder:d(()=>[Pe]),_:2},1032,["src","preview-src-list"])]))),128)),t.state.helperImageList.length==0?(c(),m("div",qe,Ge)):y("",!0)]),_:1})):y("",!0)]),_:1}),i(J,{right:40,bottom:40,class:"bg-primary text-white"})],64)}const Qe=ae(_e,[["render",Je],["__scopeId","data-v-ac262142"]]);export{Qe as default};
