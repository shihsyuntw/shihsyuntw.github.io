import{_ as we,u as De,a as xe,b as Te,i as oe,r as H,o as ke,c as S,d as Le,w as J,e as Se,f as ne,g as r,h as d,j as e,k as l,F as A,l as E,m as _,n as $,p as T,q as u,s as Ae,t as c,v as p,x as U,y as Re,z as h,A as Be,B as je}from"./index.bac4deaa.js";import{D as Ce}from"./Chart.0a715fc5.js";import{r as Me}from"./introjs.7ffc334a.js";const D=R=>(Be("data-v-02673bec"),R=R(),je(),R),Ne={class:"d-flex align-items-center justify-content-between mb-2"},qe=D(()=>d("i",{class:"bx bx-child"},null,-1)),Ie={class:"fs-3 fw-bold text-dark"},Ve=D(()=>d("strong",null,"\u6A21\u578B\u6548\u5EA6",-1)),Qe={class:"d-flex flex-wrap gap-2 mt-4"},He=["onClick"],Ee={key:0},Fe={key:1},Pe=D(()=>d("hr",null,null,-1)),Oe={class:"statistic-card"},Ye={style:{display:"inline-flex","align-items":"center"}},Je={class:"statistic-footer","data-intro":"\u986F\u793A\u5224\u7247\u7E3D\u6578\u8207\u4E0A\u9031\u7684\u6BD4\u8F03","data-step":"5"},$e={key:0,class:"footer-item"},Ue=D(()=>d("span",null,"than last week",-1)),ze={key:0,class:"green"},We={key:1,class:"red"},Ge={key:2},Ke={class:"statistic-card"},Xe={style:{display:"inline-flex","align-items":"center"}},Ze={class:"statistic-footer"},et={key:0,class:"footer-item"},tt=D(()=>d("span",null,"than last week",-1)),at={key:0,class:"green"},lt={key:1,class:"red"},ot={key:2},nt={class:"statistic-card"},st=D(()=>d("div",{style:{display:"inline-flex","align-items":"center"}}," Model Accuracy - by Defect ",-1)),dt={class:"statistic-footer"},ct={key:0,class:"footer-item"},it=D(()=>d("span",null,"than last week",-1)),rt={key:0,class:"green"},_t={key:1,class:"red"},ut={key:2},ft={class:"statistic-card"},mt=D(()=>d("div",{style:{display:"inline-flex","align-items":"center"}}," Model Accuracy - by Sample ",-1)),pt={class:"statistic-footer"},yt={key:0,class:"footer-item"},gt=D(()=>d("span",null,"than last week",-1)),ht={key:0,class:"green"},vt={key:1,class:"red"},bt={key:2},wt={class:"card-header2"},Dt=["innerHTML"],xt=["innerHTML"],Tt=["onClick","innerHTML"],kt=["innerHTML"],Lt=["innerHTML"],St=["innerHTML"],At=["onClick","innerHTML"],Rt=["innerHTML"],Bt=D(()=>d("div",{class:"card-header2"},[d("h4",null,"\u5C1A\u7121\u8CC7\u6599")],-1)),jt={key:0},Ct={__name:"PerformanceView",setup(R){const se=De(),k=xe(),z=Te(),w=oe("appSettings"),F=oe("modelList"),t=H({loadingSummaryList:!1,loadingTableList:!1,loading:!1,defectType:!0,modelState:0,model:"",modelNo:"All_Model_No",modelNoList:[],defect:"",dayRange:"7",defectImage:[],showDefectImage:!1}),L=H({judgeQty:0,replaceRatio:0,modelAccByDefect:0,modelAccBySample:0}),i=H({judgeQtyDiff:0,replaceRatioDiff:0,modelAccByDefectDiff:0,modelAccBySampleDiff:0});let x=H([]);const de=(o,n)=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"},valueFormatter:a=>a.toFixed(2)+" %"},legend:{},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:o},yAxis:[{type:"value",min:0,max:100,interval:20,axisLabel:{formatter:"{value}%"}}],series:[{data:n,type:"line"}]}),W=o=>"<span>"+o.total_judge.toLocaleString()+"</span>",G=o=>"<span>"+o.accuracy+" %</span>",K=o=>o.adc_ng_qty<o.adc_correct_qty?"<span style='color: green'>"+o.adc_correct_qty.toLocaleString()+"</span>":"<span>"+o.adc_correct_qty.toLocaleString()+"</span>",X=o=>o.adc_ng_qty==0?"<span>"+o.adc_ng_qty.toLocaleString()+"</span>":o.adc_ng_qty>o.adc_correct_qty?"<span style='color: red; text-decoration: underline'><a>"+o.adc_ng_qty.toLocaleString()+"</a></span>":"<span style='text-decoration: underline'><a>"+o.adc_ng_qty.toLocaleString()+"</a></span>",ce=async()=>{try{const o=await S.get(k.api_get_period_summary,{params:{fab:w.value.fab,stage:w.value.stage,model:t.model,day_range:t.dayRange}}),n=JSON.parse(o.data.data),f=t.defectType?"DEFECT":"REPAIR",a=n.find(y=>y.model_no===t.modelNo&&y.classify===f);Object.assign(L,a?{judgeQty:a.judge_qty,replaceRatio:a.replace_ratio,modelAccByDefect:a.model_acc_by_defect,modelAccBySample:a.model_acc_by_sample}:{judgeQty:0,replaceRatio:0,modelAccByDefect:0,modelAccBySample:0})}catch(o){console.error(o)}},ie=async()=>{try{const o=await S.get(k.api_get_period_diff,{params:{fab:w.value.fab,stage:w.value.stage,model:t.model}}),n=JSON.parse(o.data.data),f=t.defectType?"DEFECT":"REPAIR",a=n.find(y=>y.classify===f&&y.model_no===t.modelNo);Object.assign(i,a?{judgeQtyDiff:a.judge_qty_diff,replaceRatioDiff:a.replace_ratio_diff,modelAccByDefectDiff:a.model_acc_diff,modelAccBySampleDiff:a.model_acc_by_sample_diff}:{judgeQtyDiff:0,replaceRatioDiff:0,modelAccByDefectDiff:0,modelAccBySampleDiff:0})}catch(o){console.error(o)}},re=async()=>{t.loadingTableList=!0;try{const o=await S.get(k.api_get_daily_performance,{params:{fab:w.value.fab,stage:w.value.stage,model:t.model,day_range:t.dayRange}});let n=JSON.parse(o.data.data);t.modelNoList=[...n.reduce((a,y)=>a.add(y.model_no),new Set)];const f={};n.forEach(a=>{const y=t.defectType?"DEFECT":"REPAIR";if(a.classify!==y)return;const m=a.adc_answer;f[m]||(f[m]={title:m,total_judge:0,show:!0,table:[],groupTable:[],data:[],label:[]});const v=f[m];a.model_no==="All_Model_No"?(v.data.push(a.adc_correct_rate),v.groupTable.push({date:a.date,accuracy:a.adc_correct_rate,total_judge:a.adc_total_judge_qty,adc_correct_qty:a.adc_correct_qty,adc_ng_qty:a.adc_ng_qty}),v.label.push(a.date),v.total_judge+=a.adc_total_judge_qty):v.table.push({date:a.date,model_no:a.model_no,accuracy:a.adc_correct_rate,total_judge:a.adc_total_judge_qty,adc_correct_qty:a.adc_correct_qty,adc_ng_qty:a.adc_ng_qty})}),x.splice(0,x.length,...Object.keys(f).map(a=>({...f[a],title:a}))),t.modelNo!=="All_Model_No"&&x.forEach(a=>{a.table=a.table.filter(y=>y.model_no===t.modelNo)}),x.sort((a,y)=>a.show===y.show?y.total_judge-a.total_judge:a.show?-1:1)}catch(o){console.error(o)}finally{t.loadingTableList=!1}},_e=async()=>{t.loadingSummaryList=!0;try{await ce(),t.dayRange==="7"&&await ie()}catch(o){console.error(o)}finally{t.loadingSummaryList=!1}},B=()=>{re(),_e()},Z=(o,n)=>{t.modelState!=2&&(t.loading=!0,t.showDefectImage=!0,t.defectImage=[],S({method:"GET",params:{fab:w.value.fab,stage:w.value.stage,date:o,adc_model:t.model,defect:n},url:`${k.api_wrong_judge_defect_img}`}).then(function(f){t.defectImage=f.data.data}).catch(function(f){console.log(f)}).finally(()=>{t.loading=!1}))};ke(()=>{t.model=se.query.model;let o=t.modelState=F.value.find(n=>n.name===t.model);o!==void 0&&(t.modelState=o.online),t.model===void 0?S({method:"GET",url:`${k.api_model_settings}`,params:{fab:z.user.value.fab,stage:z.user.value.stage}}).then(function(n){Le.push({name:"PerformanceView",query:{model:n.data.data[0].name}})}).catch(function(n){console.log(n)}):w.value.fab!=""&&B()}),J(()=>t.dayRange,o=>{t.modelNo="All_Model_No",B()}),J(w,o=>{}),J(F,o=>{let n=t.modelState=F.value.find(f=>f.name===t.model);n!==void 0&&(t.modelState=n.online)});const j=Se(10),ue=ne(()=>x.filter(o=>o.title.toLowerCase().includes(t.defect.toLowerCase())).slice(0,j.value)),P=ne(()=>x.length>j.value),fe=o=>{let n=document.getElementById(o).offsetTop,f=500,a=window.pageYOffset,y=n-a,m;window.requestAnimationFrame(function v(C){m||(m=C);var M=C-m,O=Math.min(M/f,1);window.scrollTo(0,a+y*O),M<f&&window.requestAnimationFrame(v)})},me=()=>{P.value?j.value=x.length:j.value=10},pe=()=>{Me().start()};return(o,n)=>{const f=u("QuestionFilled"),a=u("el-icon"),y=u("el-switch"),m=u("el-col"),v=u("el-radio-button"),C=u("el-radio-group"),M=u("el-option"),O=u("el-select"),ye=u("el-input"),N=u("el-row"),ee=u("Warning"),te=u("el-tooltip"),q=u("el-statistic"),I=u("CaretTop"),V=u("CaretBottom"),Q=u("CaretLeft"),b=u("el-table-column"),ae=u("el-table"),le=u("el-card"),ge=u("el-image"),he=u("el-dialog"),ve=u("el-backtop"),Y=Ae("loading");return c(),r(A,null,[d("div",Ne,[d("div",null,[qe,d("label",Ie,[Ve,e(a,{style:{"margin-left":"6px"},size:14,onClick:n[0]||(n[0]=s=>pe())},{default:l(()=>[e(f)]),_:1})])]),e(N,null,{default:l(()=>[e(m,{md:4},{default:l(()=>[e(y,{modelValue:t.defectType,"onUpdate:modelValue":n[1]||(n[1]=s=>t.defectType=s),"active-text":"Defect","inactive-text":"IsRepair","data-intro":"\u53EF\u5207\u63DBDefect\u3001Repair\u6307\u6A19","data-step":"1",onChange:n[2]||(n[2]=s=>B())},null,8,["modelValue"])]),_:1}),e(m,{md:10,style:{"text-align":"center"},"data-intro":"\u9810\u8A2D\u6AA2\u8996\u904E\u53BB7\u5929\u7684\u5224\u7247\u6548\u5EA6\uFF0C\u53EF\u9EDE\u9078\u5207\u63DB","data-step":"2"},{default:l(()=>[e(C,{modelValue:t.dayRange,"onUpdate:modelValue":n[3]||(n[3]=s=>t.dayRange=s),disabled:t.summaryCard||t.summaryList},{default:l(()=>[e(v,{label:"7"},{default:l(()=>[p("7 days")]),_:1}),e(v,{label:"30"},{default:l(()=>[p("30 days")]),_:1}),e(v,{label:"90"},{default:l(()=>[p("90 days")]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),e(m,{md:5},{default:l(()=>[e(O,{style:{width:"90%"},modelValue:t.modelNo,"onUpdate:modelValue":n[4]||(n[4]=s=>t.modelNo=s),placeholder:"",filterable:"","data-intro":"\u53EF\u91DD\u5C0D\u4E0D\u540C Model_No \u67E5\u770B\u6A21\u578B\u6548\u5EA6","data-step":"3",onChange:n[5]||(n[5]=s=>B())},{default:l(()=>[(c(!0),r(A,null,E(t.modelNoList,s=>(c(),T(M,{label:s,value:s,key:"model-"+s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(m,{md:5},{default:l(()=>[e(ye,{style:{width:"90%"},modelValue:t.defect,"onUpdate:modelValue":n[6]||(n[6]=s=>t.defect=s),placeholder:"Search Tags...","prefix-icon":U(Re),clearable:""},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1})]),d("div",Qe,[(c(!0),r(A,null,E(ue.value,s=>(c(),r("a",{class:"badge rounded-3 bg-secondary text-light",onClick:g=>fe(s.title),key:s.title},"#"+h(s.title),9,He))),128)),d("div",{class:"badge rounded-3 bg-primary text-light",onClick:me,style:{cursor:"pointer"}},[P.value?(c(),r("span",Ee,"... More")):_("",!0),P.value?_("",!0):(c(),r("span",Fe,"Less ..."))])]),Pe,$((c(),T(N,{gutter:16},{default:l(()=>[e(m,{sm:12,md:6,"data-intro":"\u986F\u793A\u6A21\u578B\u7684\u5224\u7247\u7E3D\u6578","data-step":"4"},{default:l(()=>[d("div",Oe,[e(q,{value:L.judgeQty},{title:l(()=>[d("div",Ye,[p(" Total Judge QTY "),e(te,{effect:"dark",content:"\u5224\u7247\u7E3D\u6578",placement:"top"},{default:l(()=>[e(a,{style:{"margin-left":"4px"},size:12},{default:l(()=>[e(ee)]),_:1})]),_:1})])]),_:1},8,["value"]),d("div",Je,[t.dayRange=="7"?(c(),r("div",$e,[Ue,i.judgeQtyDiff>0?(c(),r("span",ze,[p(h(i.judgeQtyDiff)+"% ",1),e(a,null,{default:l(()=>[e(I)]),_:1})])):_("",!0),i.judgeQtyDiff<0?(c(),r("span",We,[p(h(i.judgeQtyDiff)+"% ",1),e(a,null,{default:l(()=>[e(V)]),_:1})])):_("",!0),i.judgeQtyDiff==0?(c(),r("span",Ge,[p(h(i.judgeQtyDiff)+"% ",1),e(a,null,{default:l(()=>[e(Q)]),_:1})])):_("",!0)])):_("",!0)])])]),_:1}),e(m,{sm:12,md:6,"data-intro":"\u986F\u793A\u76EE\u524D\u6A21\u578B\u5224\u7247\u7684\u53D6\u4EE3\u7387","data-step":"6"},{default:l(()=>[d("div",Ke,[e(q,{value:L.replaceRatio,precision:"1"},{title:l(()=>[d("div",Xe,[p(" Substitution Rate "),e(te,{effect:"dark",content:"\u53D6\u4EE3\u7387",placement:"top"},{default:l(()=>[e(a,{style:{"margin-left":"4px"},size:12},{default:l(()=>[e(ee)]),_:1})]),_:1})])]),suffix:l(()=>[p(" %")]),_:1},8,["value"]),d("div",Ze,[t.dayRange=="7"?(c(),r("div",et,[tt,i.replaceRatioDiff>0?(c(),r("span",at,[p(h(i.replaceRatioDiff)+"% ",1),e(a,null,{default:l(()=>[e(I)]),_:1})])):_("",!0),i.replaceRatioDiff<0?(c(),r("span",lt,[p(h(i.replaceRatioDiff)+"% ",1),e(a,null,{default:l(()=>[e(V)]),_:1})])):_("",!0),i.replaceRatioDiff==0?(c(),r("span",ot,[p(h(i.replaceRatioDiff)+"% ",1),e(a,null,{default:l(()=>[e(Q)]),_:1})])):_("",!0)])):_("",!0)])])]),_:1}),e(m,{sm:12,md:6},{default:l(()=>[d("div",nt,[e(q,{value:L.modelAccByDefect,precision:"1"},{title:l(()=>[st]),suffix:l(()=>[p(" %")]),_:1},8,["value"]),d("div",dt,[t.dayRange=="7"?(c(),r("div",ct,[it,i.modelAccByDefectDiff>0?(c(),r("span",rt,[p(h(i.modelAccByDefectDiff)+"% ",1),e(a,null,{default:l(()=>[e(I)]),_:1})])):_("",!0),i.modelAccByDefectDiff<0?(c(),r("span",_t,[p(h(i.modelAccByDefectDiff)+"% ",1),e(a,null,{default:l(()=>[e(V)]),_:1})])):_("",!0),i.modelAccByDefectDiff==0?(c(),r("span",ut,[p(h(i.modelAccByDefectDiff)+"% ",1),e(a,null,{default:l(()=>[e(Q)]),_:1})])):_("",!0)])):_("",!0)])])]),_:1}),e(m,{sm:12,md:6},{default:l(()=>[d("div",ft,[e(q,{value:L.modelAccBySample,precision:"1"},{title:l(()=>[mt]),suffix:l(()=>[p(" %")]),_:1},8,["value"]),d("div",pt,[t.dayRange=="7"?(c(),r("div",yt,[gt,i.modelAccBySampleDiff>0?(c(),r("span",ht,[p(h(i.modelAccBySampleDiff)+"% ",1),e(a,null,{default:l(()=>[e(I)]),_:1})])):_("",!0),i.modelAccBySampleDiff<0?(c(),r("span",vt,[p(h(i.modelAccBySampleDiff)+"% ",1),e(a,null,{default:l(()=>[e(V)]),_:1})])):_("",!0),i.modelAccBySampleDiff==0?(c(),r("span",bt,[p(h(i.modelAccBySampleDiff)+"% ",1),e(a,null,{default:l(()=>[e(Q)]),_:1})])):_("",!0)])):_("",!0)])])]),_:1})]),_:1})),[[Y,t.loadingSummaryList]]),$((c(),T(N,{gutter:16},{default:l(()=>[(c(!0),r(A,null,E(U(x),s=>(c(),T(m,{span:24,key:s.title,id:s.title},{default:l(()=>[s.title!="Others"?(c(),T(le,{key:0,class:"box-card"},{header:l(()=>[d("div",wt,[d("h4",null,h(s.title),1)])]),default:l(()=>[e(N,null,{default:l(()=>[e(m,{span:12},{default:l(()=>[e(Ce,{option:de(s.label,s.data),idx:s.title,style:{width:"100%",height:"350px"}},null,8,["option","idx"])]),_:2},1024),e(m,{span:12,"data-intro":"\u53EF\u9EDE\u9078 Incorrect QTY \u67E5\u770B\u5224\u932F\u7684\u7167\u7247","data-step":"7"},{default:l(()=>[t.modelNo=="All_Model_No"&&t.dayRange=="7"?(c(),T(ae,{key:0,data:s.groupTable,style:{width:"100%",height:"350px"}},{default:l(()=>[e(b,{prop:"date",label:"","min-width":"130"}),e(b,{label:"Accuracy","min-width":"130"},{default:l(g=>[d("div",{innerHTML:G(g.row)},null,8,Dt)]),_:1}),e(b,{label:"Correct QTY","min-width":"130"},{default:l(g=>[d("div",{innerHTML:K(g.row)},null,8,xt)]),_:1}),e(b,{label:"Incorrect QTY","min-width":"130"},{default:l(g=>[d("div",{onClick:be=>Z(g.row.date,s.title),innerHTML:X(g.row)},null,8,Tt)]),_:2},1024),e(b,{label:"Total Judge","min-width":"120"},{default:l(g=>[d("div",{innerHTML:W(g.row)},null,8,kt)]),_:1})]),_:2},1032,["data"])):_("",!0),t.modelNo!="All_Model_No"||t.dayRange!="7"?(c(),T(ae,{key:1,data:s.table,style:{width:"100%",height:"350px"}},{default:l(()=>[e(b,{prop:"date",label:"","min-width":"130"}),e(b,{prop:"model_no",label:"Model No","min-width":"150"}),e(b,{label:"Accuracy","min-width":"130"},{default:l(g=>[d("div",{innerHTML:G(g.row)},null,8,Lt)]),_:1}),e(b,{label:"Correct QTY","min-width":"130"},{default:l(g=>[d("div",{innerHTML:K(g.row)},null,8,St)]),_:1}),e(b,{label:"Incorrect QTY","min-width":"130"},{default:l(g=>[d("div",{onClick:be=>Z(g.row.date,s.title),innerHTML:X(g.row)},null,8,At)]),_:2},1024),e(b,{label:"Total Judge","min-width":"120"},{default:l(g=>[d("div",{innerHTML:W(g.row)},null,8,Rt)]),_:1})]),_:2},1032,["data"])):_("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)):_("",!0)]),_:2},1032,["id"]))),128)),U(x).length==0?$((c(),T(m,{key:0,span:24},{default:l(()=>[e(le,{class:"box-card"},{header:l(()=>[Bt]),_:1})]),_:1})),[[Y,t.summaryList]]):_("",!0)]),_:1})),[[Y,t.loadingTableList]]),e(he,{modelValue:t.showDefectImage,"onUpdate:modelValue":n[7]||(n[7]=s=>t.showDefectImage=s),"close-on-click-modal":!1,title:"Defect Image",width:"500",style:{"max-height":"80vh","overflow-y":"auto"}},{default:l(()=>[t.loading?(c(),r("span",jt,"Loading...")):_("",!0),(c(!0),r(A,null,E(t.defectImage,s=>(c(),T(ge,{key:s,style:{width:"100px",height:"100px","margin-left":"5px"},src:s,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[s],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"]))),128))]),_:1},8,["modelValue"]),e(ve,{right:40,bottom:40,class:"bg-primary text-white"})],64)}}},It=we(Ct,[["__scopeId","data-v-02673bec"]]);export{It as default};
